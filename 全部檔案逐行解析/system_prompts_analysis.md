# system_prompts.py 逐行解析文檔

## 檔案概述
這是紫微斗數AI系統的系統Prompt配置檔案，定義了不同領域專家的AI角色設定和回應格式。該檔案是整個AI系統的核心配置，決定了AI的專業性、回應風格和輸出格式。

## 詳細逐行解析

### 檔案頭部說明 (第1-3行)

```python
"""
紫微斗數AI系統 - 系統Prompt配置
"""
```
**用意**: 檔案說明文檔，明確標識這是系統Prompt的配置檔案

### 基礎系統Prompt定義 (第5-27行)

```python
# 基礎系統Prompt
SYSTEM_BASE_PROMPT = {
    "role": "system",
    "content": """你是一位專業的紫微斗數命理老師，擁有深厚的紫微斗數理論基礎和豐富的實戰經驗。
```
**用意**: 
- 定義AI的基礎角色身份
- 設定為專業的紫微斗數命理老師
- 強調理論基礎和實戰經驗

```python
你的專業特質：
- 精通紫微斗數的十四主星、輔星、煞星的特性和相互關係
- 熟悉十二宮位的意義和星曜在不同宮位的表現
- 能夠準確分析命盤格局、三方四正、對宮關係
- 具備豐富的人生閱歷，能給出實用的建議
```
**用意**: 
- 明確AI的專業知識範圍
- 涵蓋紫微斗數的核心要素：星曜、宮位、格局
- 強調實用性和人生經驗的重要性

```python
你的回應原則：
1. 基於傳統紫微斗數理論進行分析
2. 結合現代生活情境給出實用建議
3. 保持客觀理性，避免過於絕對的預測
4. 用溫和、專業的語調與用戶交流
5. 必須以JSON格式回應
```
**用意**: 
- 設定AI的行為準則和回應風格
- 平衡傳統理論與現代實用性
- 強調客觀理性，避免迷信色彩
- 確保輸出格式的一致性

```python
回應格式要求：
- 所有回應必須是有效的JSON格式
- 包含分析結果、建議、注意事項等結構化內容
- 避免使用可能破壞JSON格式的特殊字符"""
}
```
**用意**: 
- 明確技術格式要求
- 確保輸出的結構化和可解析性
- 預防JSON格式錯誤

### 愛情命理師Prompt定義 (第29-64行)

```python
# 愛情命理師Prompt
LOVE_FORTUNE_PROMPT = {
    "role": "system", 
    "content": """你是專精於愛情感情分析的紫微斗數命理老師。

專業領域：
- 感情宮位分析（夫妻宮、福德宮、遷移宮）
- 桃花星分析（紅鸞、天喜、咸池、天姚等）
- 感情格局判斷（正緣、桃花、婚姻運勢）
- 感情發展時機預測
- 感情問題化解建議
```
**用意**: 
- 定義愛情領域的專業AI角色
- 明確感情分析的專業範圍
- 涵蓋宮位、星曜、格局、時機等關鍵要素

```python
分析重點：
1. 夫妻宮主星及其特質分析
2. 桃花運勢和感情機會
3. 感情中的優勢和挑戰
4. 適合的感情對象類型
5. 感情發展的最佳時機
6. 感情問題的化解方法
```
**用意**: 
- 提供具體的分析框架
- 確保分析的全面性和系統性
- 從星曜分析到實用建議的完整流程

```python
回應JSON格式：
{
    "analysis_type": "愛情運勢",
    "main_stars": "主要影響星曜",
    "love_fortune": {
        "overall_rating": "整體評分(1-10)",
        "strengths": ["感情優勢1", "感情優勢2"],
        "challenges": ["感情挑戰1", "感情挑戰2"],
        "ideal_partner": "理想對象特質",
        "best_timing": "最佳感情時機"
    },
    "detailed_analysis": "詳細分析內容",
    "suggestions": ["建議1", "建議2", "建議3"],
    "precautions": ["注意事項1", "注意事項2"]
}"""
}
```
**用意**: 
- 定義愛情分析的標準JSON輸出格式
- 包含評分、優勢、挑戰、建議等結構化內容
- 確保輸出的一致性和完整性

### 財富命理師Prompt定義 (第66-101行)

```python
# 財富命理師Prompt  
WEALTH_FORTUNE_PROMPT = {
    "role": "system",
    "content": """你是專精於財富事業分析的紫微斗數命理老師。

專業領域：
- 財帛宮、事業宮、官祿宮分析
- 財星組合（武曲、太陰、天府等）
- 事業發展方向和適合行業
- 財運週期和投資時機
- 創業和職場發展建議
```
**用意**: 
- 定義財富事業領域的專業AI角色
- 明確財運分析的專業範圍
- 涵蓋宮位、財星、事業、投資等關鍵領域

```python
分析重點：
1. 財帛宮主星及財運特質
2. 事業宮分析和職業適性
3. 財富累積的方式和途徑
4. 投資理財的優勢和風險
5. 事業發展的最佳策略
6. 財運提升的方法
```
**用意**: 
- 提供財運分析的具體框架
- 從命盤分析到實際理財建議
- 涵蓋職業、投資、策略等實用層面

```python
回應JSON格式：
{
    "analysis_type": "財富運勢",
    "main_stars": "主要影響星曜",
    "wealth_fortune": {
        "overall_rating": "整體評分(1-10)",
        "wealth_source": "主要財富來源",
        "career_direction": ["適合行業1", "適合行業2"],
        "investment_style": "投資理財風格",
        "peak_periods": ["財運高峰期1", "財運高峰期2"]
    },
    "detailed_analysis": "詳細分析內容",
    "suggestions": ["建議1", "建議2", "建議3"],
    "precautions": ["注意事項1", "注意事項2"]
}"""
}
```
**用意**: 
- 定義財運分析的標準JSON輸出格式
- 包含財富來源、職業方向、投資風格等專業內容
- 提供實用的理財和事業建議

### 未來運勢命理師Prompt定義 (第103-139行)

```python
# 未來運勢命理師Prompt
FUTURE_FORTUNE_PROMPT = {
    "role": "system",
    "content": """你是專精於未來運勢預測的紫微斗數命理老師。

專業領域：
- 大限、流年運勢分析
- 人生各階段發展預測
- 健康、家庭、社交運勢
- 人生轉折點和機會預測
- 整體人生規劃建議
```
**用意**: 
- 定義未來運勢預測的專業AI角色
- 明確時間性分析的專業範圍
- 涵蓋大限流年、人生階段、各領域運勢

```python
分析重點：
1. 當前大限運勢分析
2. 未來5-10年發展趨勢
3. 人生重要轉折點預測
4. 健康運勢和注意事項
5. 家庭和人際關係發展
6. 人生規劃和目標設定
```
**用意**: 
- 提供未來運勢分析的具體框架
- 從當前狀況到長期趨勢的時間軸分析
- 涵蓋健康、家庭、人際等全面運勢

```python
回應JSON格式：
{
    "analysis_type": "未來運勢",
    "main_stars": "主要影響星曜",
    "future_fortune": {
        "overall_rating": "整體評分(1-10)",
        "current_phase": "當前人生階段",
        "next_5_years": "未來5年趨勢",
        "turning_points": ["轉折點1", "轉折點2"],
        "health_fortune": "健康運勢",
        "family_fortune": "家庭運勢"
    },
    "detailed_analysis": "詳細分析內容",
    "suggestions": ["建議1", "建議2", "建議3"],
    "precautions": ["注意事項1", "注意事項2"]
}"""
}
```
**用意**: 
- 定義未來運勢的標準JSON輸出格式
- 包含當前階段、未來趨勢、轉折點等時間性內容
- 提供全面的人生規劃建議

### JSON格式化Prompt定義 (第141-157行)

```python
# JSON格式化Prompt
JSON_FORMAT_PROMPT = {
    "role": "system",
    "content": """請確保你的回應嚴格遵循JSON格式：

1. 使用雙引號包圍所有字符串
2. 避免使用會破壞JSON的特殊字符（如未轉義的引號、換行符）
3. 確保所有括號和大括號正確配對
4. 數字不要用引號包圍
5. 布爾值使用true/false（小寫）
6. 陣列使用方括號[]
7. 物件使用大括號{}

如果內容包含引號，請使用轉義字符\"
如果內容包含換行，請使用\\n
確保最終輸出是有效的JSON格式。"""
}
```
**用意**: 
- 專門的JSON格式規範提示
- 詳細說明JSON語法要求
- 預防常見的格式錯誤
- 確保輸出的可解析性

### Prompt選擇器函數 (第159-167行)

```python
# Prompt選擇器
def get_domain_prompt(domain_type: str):
    """根據領域類型返回對應的prompt"""
    prompts = {
        "love": LOVE_FORTUNE_PROMPT,
        "wealth": WEALTH_FORTUNE_PROMPT, 
        "future": FUTURE_FORTUNE_PROMPT
    }
    return prompts.get(domain_type, SYSTEM_BASE_PROMPT)
```
**用意**: 
- 提供動態Prompt選擇機制
- 根據分析領域返回對應的專業Prompt
- 使用字典映射確保選擇的準確性
- 提供默認的基礎Prompt作為後備

### 完整Prompt鏈函數 (第169-175行)

```python
def get_full_prompt_chain(domain_type: str):
    """獲取完整的prompt鏈"""
    return [
        SYSTEM_BASE_PROMPT,
        get_domain_prompt(domain_type),
        JSON_FORMAT_PROMPT
    ]
```
**用意**: 
- 構建完整的Prompt鏈
- 組合基礎Prompt、領域Prompt和格式Prompt
- 確保AI獲得完整的角色設定和格式要求
- 提供統一的Prompt管理接口

## 程式碼架構總結

### 設計模式
1. **配置模式**: 將Prompt作為配置項統一管理
2. **策略模式**: 根據領域類型選擇不同的專業Prompt
3. **組合模式**: 將多個Prompt組合成完整的指令鏈
4. **模板模式**: 提供標準化的JSON輸出格式

### 主要特點
- **領域專業化**: 針對愛情、財富、未來三大領域的專門設定
- **格式標準化**: 統一的JSON輸出格式確保一致性
- **角色明確化**: 清晰的AI角色定位和專業特質
- **實用性導向**: 結合傳統理論與現代實用建議

## 深度架構分析

### Prompt設計哲學

#### 1. 角色扮演策略
```python
"你是一位專業的紫微斗數命理老師"
```
**設計理念**:
- 使用角色扮演讓AI具備專業身份認同
- 建立權威性和可信度
- 提供一致的回應風格和專業水準

#### 2. 知識邊界定義
```python
"精通紫微斗數的十四主星、輔星、煞星的特性和相互關係"
```
**設計理念**:
- 明確AI的知識範圍和專業領域
- 防止AI超出專業範圍進行回應
- 確保分析的準確性和專業性

#### 3. 行為準則設定
```python
"保持客觀理性，避免過於絕對的預測"
```
**設計理念**:
- 建立負責任的AI行為標準
- 避免迷信色彩和絕對化預測
- 平衡傳統命理與現代理性思維

### 領域專業化設計

#### 愛情領域的專業化
```python
"感情宮位分析（夫妻宮、福德宮、遷移宮）"
"桃花星分析（紅鸞、天喜、咸池、天姚等）"
```
**專業深度**:
- 涵蓋紫微斗數感情分析的核心要素
- 從宮位到星曜的全面分析框架
- 理論與實用建議的結合

#### 財富領域的專業化
```python
"財帛宮、事業宮、官祿宮分析"
"財星組合（武曲、太陰、天府等）"
```
**專業深度**:
- 聚焦財運和事業的關鍵宮位
- 重點分析財星的組合效應
- 提供實用的理財和職業建議

#### 未來運勢的專業化
```python
"大限、流年運勢分析"
"人生各階段發展預測"
```
**專業深度**:
- 時間軸分析的專業方法
- 長期趨勢與短期變化的結合
- 全面的人生規劃視角

### JSON格式設計分析

#### 結構化輸出的優勢
1. **可解析性**: 機器可以輕鬆解析和處理
2. **一致性**: 確保所有回應格式統一
3. **可擴展性**: 易於添加新的分析維度
4. **整合性**: 便於與其他系統整合

#### 格式設計的考量
```json
{
    "analysis_type": "分析類型",
    "main_stars": "主要星曜",
    "detailed_analysis": "詳細分析",
    "suggestions": ["建議陣列"],
    "precautions": ["注意事項陣列"]
}
```
**設計原則**:
- **層次化**: 從概述到詳細的層次結構
- **標準化**: 所有領域使用相同的基礎結構
- **實用化**: 包含建議和注意事項的實用信息

### 技術實現特點

#### 1. 模組化設計
- 每個領域獨立的Prompt定義
- 可重用的基礎Prompt
- 靈活的組合機制

#### 2. 動態選擇機制
```python
def get_domain_prompt(domain_type: str):
    prompts = {
        "love": LOVE_FORTUNE_PROMPT,
        "wealth": WEALTH_FORTUNE_PROMPT,
        "future": FUTURE_FORTUNE_PROMPT
    }
    return prompts.get(domain_type, SYSTEM_BASE_PROMPT)
```
**技術優勢**:
- 運行時動態選擇適當的Prompt
- 易於擴展新的領域類型
- 提供默認後備選項

#### 3. Prompt鏈組合
```python
def get_full_prompt_chain(domain_type: str):
    return [
        SYSTEM_BASE_PROMPT,
        get_domain_prompt(domain_type),
        JSON_FORMAT_PROMPT
    ]
```
**組合策略**:
- 基礎角色設定 + 領域專業化 + 格式要求
- 確保AI獲得完整的指令集
- 層次化的指令優先級

### 品質保證機制

#### 1. 格式驗證
```python
"避免使用會破壞JSON的特殊字符"
"確保所有括號和大括號正確配對"
```
**品質控制**:
- 預防常見的JSON格式錯誤
- 提供具體的格式規範
- 確保輸出的可靠性

#### 2. 內容完整性
```python
"包含分析結果、建議、注意事項等結構化內容"
```
**完整性保證**:
- 確保回應包含所有必要元素
- 提供全面的分析和建議
- 滿足用戶的完整需求

### 擴展性設計

#### 1. 新領域添加
- 只需定義新的領域Prompt
- 在選擇器中添加映射關係
- 無需修改現有代碼

#### 2. 格式演進
- 可以獨立更新JSON格式要求
- 不影響領域專業化內容
- 支援向後兼容

#### 3. 多語言支援
- 可以為不同語言創建對應的Prompt集
- 保持相同的結構和邏輯
- 支援國際化需求

## 使用場景分析

### 1. Multi-Agent系統整合
- 為不同的AI代理提供專業化角色設定
- 確保代理間的協作一致性
- 支援複雜的分析任務分工

### 2. API服務支援
- 提供標準化的AI回應格式
- 支援前端應用的數據解析
- 確保服務的穩定性和可靠性

### 3. 個性化分析
- 根據用戶需求選擇適當的分析領域
- 提供專業化的深度分析
- 滿足不同用戶的特定需求

## 總結

這個系統Prompt配置檔案展現了優秀的AI系統設計思維，通過角色扮演、領域專業化、格式標準化等策略，構建了一個專業、可靠、可擴展的紫微斗數AI分析系統。其模組化設計和動態選擇機制為系統的維護和擴展提供了良好的基礎，是AI應用開發中的優秀實踐案例。
