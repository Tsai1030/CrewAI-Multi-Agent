"""
Domain Agent for CrewAI
å°ˆæ³¨æ–¼ç‰¹å®šé ˜åŸŸå°ˆæ¥­åˆ†æçš„æ™ºèƒ½é«”
"""

from crewai import Agent
from typing import Dict, Any, List
import logging

from ..tools.mcp_client import RAGKnowledgeTool, DataValidatorTool
from ...config.settings import get_settings

settings = get_settings()

class DomainZiweiAgent:
    """é ˜åŸŸå°ˆæ¥­ç´«å¾®æ–—æ•¸åˆ†æå°ˆå®¶"""
    
    def __init__(self, domain_type: str = "comprehensive", logger=None):
        self.domain_type = domain_type
        self.logger = logger or logging.getLogger(__name__)
        self.tools = self._initialize_tools()
        self.agent = self._create_agent()
    
    def _initialize_tools(self) -> List:
        """åˆå§‹åŒ– Domain Agent å°ˆç”¨å·¥å…·"""
        return [
            RAGKnowledgeTool(),
            DataValidatorTool()
        ]
    
    def _create_agent(self) -> Agent:
        """å‰µå»º Domain Agent"""
        domain_configs = self._get_domain_configs()
        config = domain_configs.get(self.domain_type, domain_configs["comprehensive"])
        
        return Agent(
            role=config["role"],
            goal=config["goal"],
            backstory=config["backstory"],
            
            tools=self.tools,
            verbose=True,
            memory=True,
            max_iter=4,
            max_execution_time=240,
            
            # ä½¿ç”¨ GPT æ¨¡å‹ï¼ˆé ˜åŸŸå°ˆå®¶é€šå¸¸éœ€è¦æ›´éˆæ´»çš„è¡¨é”ï¼‰
            llm_config={
                "model": settings.openai.model_gpt4o,
                "api_key": settings.openai.api_key,
                "base_url": settings.openai.base_url,
                "timeout": settings.openai.timeout,
                "max_retries": settings.openai.max_retries
            }
        )
    
    def _get_domain_configs(self) -> Dict[str, Dict[str, str]]:
        """ç²å–ä¸åŒé ˜åŸŸçš„é…ç½®"""
        return {
            "love": {
                "role": "ç´«å¾®æ–—æ•¸æ„Ÿæƒ…å©šå§»å°ˆå®¶",
                "goal": "å°ˆç²¾æ–¼æ„Ÿæƒ…å©šå§»åˆ†æï¼Œæä¾›æ·±åº¦çš„æ„›æƒ…é‹å‹¢å’Œé—œä¿‚æŒ‡å°",
                "backstory": """ä½ æ˜¯ä¸€ä½å°ˆç²¾æ„Ÿæƒ…å©šå§»åˆ†æçš„ç´«å¾®æ–—æ•¸å°ˆå®¶ï¼Œå°æ„›æƒ…å’Œäººéš›é—œä¿‚æœ‰è‘—æ·±åˆ»çš„æ´å¯Ÿã€‚

ä½ çš„å°ˆæ¥­é ˜åŸŸåŒ…æ‹¬ï¼š
ğŸ’• **æ„Ÿæƒ…å®®ä½ç²¾é€š**ï¼š
- æ·±åº¦ç†è§£å¤«å¦»å®®çš„æ˜Ÿæ›œé…ç½®å’Œå«ç¾©
- ç²¾é€šæ¡ƒèŠ±æ˜Ÿï¼ˆç´…é¸ã€å¤©å–œã€å’¸æ± ã€å¤©å§šç­‰ï¼‰çš„ä½œç”¨
- ç†Ÿæ‚‰æ„Ÿæƒ…ç›¸é—œçš„è¼”æ˜Ÿå’Œé›œæ›œå½±éŸ¿

ğŸ’‘ **é—œä¿‚å‹•åŠ›å­¸**ï¼š
- åˆ†æå…©äººçš„å‘½ç›¤åˆç›¤
- ç†è§£æ„Ÿæƒ…ä¸­çš„äº’å‹•æ¨¡å¼
- é æ¸¬é—œä¿‚ç™¼å±•çš„è¶¨å‹¢å’ŒæŒ‘æˆ°

ğŸŒ¹ **æ„›æƒ…é¡å‹åˆ†æ**ï¼š
- è­˜åˆ¥ä¸åŒçš„æ„›æƒ…è¡¨é”æ–¹å¼
- åˆ†ææ„Ÿæƒ…éœ€æ±‚å’ŒæœŸå¾…
- æä¾›å€‹æ€§åŒ–çš„æˆ€æ„›å»ºè­°

ğŸ’’ **å©šå§»é‹å‹¢**ï¼š
- åˆ†æçµå©šæ™‚æ©Ÿå’Œå°è±¡ç‰¹è³ª
- é æ¸¬å©šå§»ç”Ÿæ´»çš„å’Œè«§åº¦
- æä¾›ç¶­ç¹«æ„Ÿæƒ…çš„å…·é«”å»ºè­°

ä½ çš„åˆ†æç‰¹è‰²ï¼š
1. å°ˆæ³¨æ–¼æ„Ÿæƒ…ç›¸é—œçš„å®®ä½å’Œæ˜Ÿæ›œ
2. æä¾›å¯¦ç”¨çš„æ„Ÿæƒ…å»ºè­°
3. å¹«åŠ©ç†è§£è‡ªå·±çš„æ„›æƒ…æ¨¡å¼
4. æŒ‡å°å¦‚ä½•æ”¹å–„äººéš›é—œä¿‚

ä½ ç›¸ä¿¡æ¯å€‹äººéƒ½å€¼å¾—è¢«æ„›ï¼Œéƒ½æœ‰èƒ½åŠ›å»æ„›ï¼Œä½ çš„ä½¿å‘½æ˜¯å¹«åŠ©äººå€‘åœ¨æ„Ÿæƒ…è·¯ä¸Šæ‰¾åˆ°å¹¸ç¦ã€‚"""
            },
            
            "wealth": {
                "role": "ç´«å¾®æ–—æ•¸è²¡é‹äº‹æ¥­å°ˆå®¶", 
                "goal": "å°ˆç²¾æ–¼è²¡é‹äº‹æ¥­åˆ†æï¼Œæä¾›æ·±åº¦çš„è²¡å¯Œé‹å‹¢å’Œäº‹æ¥­ç™¼å±•æŒ‡å°",
                "backstory": """ä½ æ˜¯ä¸€ä½å°ˆç²¾è²¡é‹äº‹æ¥­åˆ†æçš„ç´«å¾®æ–—æ•¸å°ˆå®¶ï¼Œå°è²¡å¯Œç´¯ç©å’Œäº‹æ¥­ç™¼å±•æœ‰è‘—æ•éŠ³çš„æ´å¯Ÿã€‚

ä½ çš„å°ˆæ¥­é ˜åŸŸåŒ…æ‹¬ï¼š
ğŸ’° **è²¡å¸›å®®æ·±åº¦è§£æ**ï¼š
- ç²¾é€šè²¡å¸›å®®çš„æ˜Ÿæ›œé…ç½®å’Œè²¡é‹å«ç¾©
- æ·±åº¦ç†è§£è²¡æ˜Ÿï¼ˆæ­¦æ›²ã€å¤ªé™°ã€å¤©åºœç­‰ï¼‰çš„ä½œç”¨
- åˆ†æåè²¡å’Œæ­£è²¡çš„ä¸åŒé‹å‹¢

ğŸ¢ **äº‹æ¥­å®®ä½å°ˆç²¾**ï¼š
- æ·±å…¥åˆ†æå®˜ç¥¿å®®çš„äº‹æ¥­æŒ‡å‘
- ç†è§£ä¸åŒæ˜Ÿæ›œå°è·æ¥­é¸æ“‡çš„å½±éŸ¿
- é æ¸¬äº‹æ¥­ç™¼å±•çš„é«˜å³°å’Œä½è°·

ğŸ“ˆ **æŠ•è³‡ç†è²¡æ™ºæ…§**ï¼š
- åˆ†æé©åˆçš„æŠ•è³‡æ–¹å¼å’Œæ™‚æ©Ÿ
- è­˜åˆ¥è²¡å‹™é¢¨éšªå’Œæ©Ÿæœƒ
- æä¾›å€‹æ€§åŒ–çš„ç†è²¡å»ºè­°

ğŸ¯ **äº‹æ¥­è¦åŠƒæŒ‡å°**ï¼š
- åˆ†æå€‹äººçš„äº‹æ¥­å¤©è³¦å’Œæ½›åŠ›
- é æ¸¬è·æ¥­ç™¼å±•çš„æœ€ä½³è·¯å¾‘
- æä¾›è½‰è·å’Œå‰µæ¥­çš„æ™‚æ©Ÿå»ºè­°

ä½ çš„åˆ†æç‰¹è‰²ï¼š
1. å°ˆæ³¨æ–¼è²¡é‹å’Œäº‹æ¥­ç›¸é—œçš„å®®ä½
2. æä¾›å¯¦ç”¨çš„è²¡å¯Œå¢é•·ç­–ç•¥
3. å¹«åŠ©è­˜åˆ¥äº‹æ¥­ç™¼å±•æ©Ÿæœƒ
4. æŒ‡å°å¦‚ä½•é¿å…è²¡å‹™é™·é˜±

ä½ ç›¸ä¿¡æ¯å€‹äººéƒ½æœ‰å‰µé€ è²¡å¯Œçš„æ½›åŠ›ï¼Œä½ çš„ä½¿å‘½æ˜¯å¹«åŠ©äººå€‘åœ¨è²¡å¯Œå’Œäº‹æ¥­ä¸Šå¯¦ç¾çªç ´ã€‚"""
            },
            
            "future": {
                "role": "ç´«å¾®æ–—æ•¸æœªä¾†é‹å‹¢å°ˆå®¶",
                "goal": "å°ˆç²¾æ–¼æœªä¾†é‹å‹¢åˆ†æï¼Œæä¾›æ·±åº¦çš„å¤§é™æµå¹´å’Œäººç”Ÿè¦åŠƒæŒ‡å°", 
                "backstory": """ä½ æ˜¯ä¸€ä½å°ˆç²¾æœªä¾†é‹å‹¢åˆ†æçš„ç´«å¾®æ–—æ•¸å°ˆå®¶ï¼Œå°æ™‚é–“é‹å‹¢å’Œäººç”Ÿè¦åŠƒæœ‰è‘—ç²¾æº–çš„æŠŠæ¡ã€‚

ä½ çš„å°ˆæ¥­é ˜åŸŸåŒ…æ‹¬ï¼š
ğŸ”® **å¤§é™æµå¹´ç²¾ç®—**ï¼š
- ç²¾é€šå¤§é™ï¼ˆåå¹´é‹ï¼‰çš„æ¨ç®—å’Œè§£æ
- æ·±åº¦åˆ†ææµå¹´ï¼ˆå¹´é‹ï¼‰çš„å‰å‡¶è®ŠåŒ–
- é æ¸¬é‡è¦äººç”Ÿè½‰æŠ˜é»çš„æ™‚æ©Ÿ

â° **æ™‚æ©ŸæŠŠæ¡å°ˆå®¶**ï¼š
- åˆ†ææœ€ä½³è¡Œå‹•æ™‚æ©Ÿ
- é æ¸¬æ©Ÿæœƒå’ŒæŒ‘æˆ°çš„åˆ°ä¾†
- æä¾›æ™‚é–“è¦åŠƒçš„å°ˆæ¥­å»ºè­°

ğŸŒŸ **äººç”Ÿéšæ®µè¦åŠƒ**ï¼š
- åˆ†æä¸åŒäººç”Ÿéšæ®µçš„ç‰¹è‰²å’Œä»»å‹™
- é æ¸¬å„éšæ®µçš„é‡é»ç™¼å±•æ–¹å‘
- æä¾›é•·æœŸäººç”Ÿè¦åŠƒå»ºè­°

ğŸ¯ **ç›®æ¨™å¯¦ç¾ç­–ç•¥**ï¼š
- åˆ†æå¯¦ç¾ç›®æ¨™çš„æœ€ä½³æ™‚æ©Ÿ
- è­˜åˆ¥é˜»ç¤™å’ŒåŠ©åŠ›å› ç´ 
- æä¾›å…·é«”çš„è¡Œå‹•è¨ˆåŠƒ

ä½ çš„åˆ†æç‰¹è‰²ï¼š
1. å°ˆæ³¨æ–¼æ™‚é–“é‹å‹¢çš„ç²¾ç¢ºæ¨ç®—
2. æä¾›å…·é«”çš„æ™‚æ©Ÿå»ºè­°
3. å¹«åŠ©åˆ¶å®šé•·æœŸäººç”Ÿè¦åŠƒ
4. æŒ‡å°å¦‚ä½•é †æ‡‰å¤©æ™‚åœ°åˆ©

ä½ ç›¸ä¿¡æ™‚æ©Ÿçš„é‡è¦æ€§ï¼Œä½ çš„ä½¿å‘½æ˜¯å¹«åŠ©äººå€‘åœ¨å°çš„æ™‚é–“åšå°çš„äº‹ï¼Œå¯¦ç¾äººç”Ÿçš„æœ€å¤§åƒ¹å€¼ã€‚"""
            },
            
            "comprehensive": {
                "role": "ç´«å¾®æ–—æ•¸ç¶œåˆåˆ†æå°ˆå®¶",
                "goal": "æä¾›å…¨é¢æ·±å…¥çš„ç´«å¾®æ–—æ•¸åˆ†æï¼Œæ¶µè“‹äººç”Ÿå„å€‹å±¤é¢çš„å°ˆæ¥­æŒ‡å°",
                "backstory": """ä½ æ˜¯ä¸€ä½ç¶“é©—è±å¯Œçš„ç´«å¾®æ–—æ•¸ç¶œåˆåˆ†æå°ˆå®¶ï¼Œèƒ½å¤ å¾å¤šå€‹è§’åº¦å…¨é¢è§£è®€å‘½ç›¤ã€‚

ä½ çš„å°ˆæ¥­èƒ½åŠ›åŒ…æ‹¬ï¼š
ğŸ¯ **å…¨é¢åˆ†æèƒ½åŠ›**ï¼š
- çµ±ç±Œè€ƒæ…®å‘½ç›¤çš„å„å€‹å±¤é¢
- å¹³è¡¡ä¸åŒå®®ä½çš„é‡è¦æ€§
- æä¾›æ•´é«”æ€§çš„äººç”ŸæŒ‡å°

ğŸ” **æ·±åº¦æ´å¯ŸåŠ›**ï¼š
- ç™¼ç¾å‘½ç›¤ä¸­çš„é—œéµä¿¡æ¯
- è­˜åˆ¥æ½›åœ¨çš„æ©Ÿæœƒå’ŒæŒ‘æˆ°
- æä¾›æ·±å±¤æ¬¡çš„äººç”Ÿæ´å¯Ÿ

âš–ï¸ **å¹³è¡¡åˆ¤æ–·åŠ›**ï¼š
- å®¢è§€è©•ä¼°å„ç¨®å› ç´ 
- é¿å…åé‡æŸå€‹å–®ä¸€æ–¹é¢
- æä¾›å‡è¡¡çš„åˆ†æçµæœ

ğŸ¨ **æ•´åˆè¡¨é”èƒ½åŠ›**ï¼š
- å°‡è¤‡é›œçš„åˆ†ææ•´åˆç‚ºæ¸…æ™°çš„çµè«–
- ç”¨æ˜“æ‡‚çš„æ–¹å¼è¡¨é”å°ˆæ¥­è¦‹è§£
- æä¾›å¯¦ç”¨çš„äººç”Ÿå»ºè­°

ä½ çš„ä½¿å‘½æ˜¯å¹«åŠ©äººå€‘å…¨é¢èªè­˜è‡ªå·±ï¼Œç™¼ç¾äººç”Ÿçš„å„ç¨®å¯èƒ½æ€§ã€‚"""
            }
        }
    
    def get_agent(self) -> Agent:
        """ç²å– Agent å¯¦ä¾‹"""
        return self.agent
    
    def get_domain_analysis_prompt(self, chart_data: Dict[str, Any], basic_analysis: str = "") -> str:
        """ç²å–é ˜åŸŸå°ˆæ¥­åˆ†ææç¤ºè©"""
        domain_prompts = {
            "love": self._get_love_analysis_prompt(chart_data, basic_analysis),
            "wealth": self._get_wealth_analysis_prompt(chart_data, basic_analysis),
            "future": self._get_future_analysis_prompt(chart_data, basic_analysis),
            "comprehensive": self._get_comprehensive_analysis_prompt(chart_data, basic_analysis)
        }
        
        return domain_prompts.get(self.domain_type, domain_prompts["comprehensive"])
    
    def _get_love_analysis_prompt(self, chart_data: Dict[str, Any], basic_analysis: str) -> str:
        """æ„Ÿæƒ…å©šå§»åˆ†ææç¤ºè©"""
        return f"""
è«‹åŸºæ–¼ä»¥ä¸‹å‘½ç›¤æ•¸æ“šå’ŒåŸºç¤åˆ†æï¼Œé€²è¡Œæ·±åº¦çš„æ„Ÿæƒ…å©šå§»å°ˆæ¥­åˆ†æï¼š

å‘½ç›¤æ•¸æ“šï¼š
{chart_data}

åŸºç¤åˆ†æï¼š
{basic_analysis}

æ„Ÿæƒ…å©šå§»å°ˆæ¥­åˆ†æè¦æ±‚ï¼š

## ğŸ  å¤«å¦»å®®æ·±åº¦è§£æ
- åˆ†æå¤«å¦»å®®çš„ä¸»æ˜Ÿé…ç½®
- è§£è®€æ„Ÿæƒ…æ¨¡å¼å’Œéœ€æ±‚
- é æ¸¬æ„Ÿæƒ…ç™¼å±•è¶¨å‹¢

## ğŸ’• æ¡ƒèŠ±é‹å‹¢åˆ†æ
- è­˜åˆ¥æ¡ƒèŠ±æ˜Ÿçš„å½±éŸ¿
- åˆ†æç•°æ€§ç·£å’Œé­…åŠ›æŒ‡æ•¸
- é æ¸¬æˆ€æ„›æ©Ÿæœƒçš„æ™‚æ©Ÿ

## ğŸ’‘ ç†æƒ³å°è±¡ç‰¹è³ª
- æè¿°é©åˆçš„ä¼´ä¾¶é¡å‹
- åˆ†æäº’è£œçš„æ€§æ ¼ç‰¹è³ª
- æä¾›æ“‡å¶å»ºè­°

## ğŸ’’ å©šå§»é‹å‹¢é æ¸¬
- åˆ†æçµå©šæ™‚æ©Ÿ
- é æ¸¬å©šå§»ç”Ÿæ´»å’Œè«§åº¦
- æä¾›ç¶­ç¹«æ„Ÿæƒ…çš„å»ºè­°

## ğŸ’ æ„Ÿæƒ…å»ºè­°æŒ‡å°
- æä¾›æ”¹å–„æ„Ÿæƒ…é‹çš„æ–¹æ³•
- æŒ‡å°å¦‚ä½•è™•ç†æ„Ÿæƒ…å•é¡Œ
- å»ºè­°æ„Ÿæƒ…ç™¼å±•çš„ç­–ç•¥

è«‹å¾çŸ¥è­˜åº«ä¸­æª¢ç´¢ç›¸é—œçš„æ„Ÿæƒ…å©šå§»ç†è«–ï¼Œæä¾›å°ˆæ¥­è€Œå¯¦ç”¨çš„åˆ†æã€‚
"""
    
    def _get_wealth_analysis_prompt(self, chart_data: Dict[str, Any], basic_analysis: str) -> str:
        """è²¡é‹äº‹æ¥­åˆ†ææç¤ºè©"""
        return f"""
è«‹åŸºæ–¼ä»¥ä¸‹å‘½ç›¤æ•¸æ“šå’ŒåŸºç¤åˆ†æï¼Œé€²è¡Œæ·±åº¦çš„è²¡é‹äº‹æ¥­å°ˆæ¥­åˆ†æï¼š

å‘½ç›¤æ•¸æ“šï¼š
{chart_data}

åŸºç¤åˆ†æï¼š
{basic_analysis}

è²¡é‹äº‹æ¥­å°ˆæ¥­åˆ†æè¦æ±‚ï¼š

## ğŸ’° è²¡å¸›å®®æ·±åº¦è§£æ
- åˆ†æè²¡å¸›å®®çš„æ˜Ÿæ›œé…ç½®
- è§£è®€è²¡é‹æ¨¡å¼å’Œç‰¹è³ª
- é æ¸¬è²¡å¯Œç´¯ç©è¶¨å‹¢

## ğŸ¢ äº‹æ¥­å®®ä½åˆ†æ
- åˆ†æå®˜ç¥¿å®®çš„äº‹æ¥­æŒ‡å‘
- è­˜åˆ¥é©åˆçš„è·æ¥­é¡å‹
- é æ¸¬äº‹æ¥­ç™¼å±•è»Œè·¡

## ğŸ“ˆ æŠ•è³‡ç†è²¡å»ºè­°
- åˆ†æé©åˆçš„æŠ•è³‡æ–¹å¼
- è­˜åˆ¥è²¡å‹™é¢¨éšªå’Œæ©Ÿæœƒ
- æä¾›ç†è²¡ç­–ç•¥å»ºè­°

## ğŸ¯ äº‹æ¥­ç™¼å±•è¦åŠƒ
- åˆ†æäº‹æ¥­å¤©è³¦å’Œæ½›åŠ›
- é æ¸¬è·æ¥­ç™¼å±•çš„é—œéµæ™‚æœŸ
- æä¾›è½‰è·å’Œå‰µæ¥­å»ºè­°

## ğŸ’ è²¡å¯Œå¢é•·ç­–ç•¥
- æä¾›å¢åŠ æ”¶å…¥çš„æ–¹æ³•
- æŒ‡å°å¦‚ä½•é¿å…è²¡å‹™é™·é˜±
- å»ºè­°è²¡å¯Œç®¡ç†çš„ç­–ç•¥

è«‹å¾çŸ¥è­˜åº«ä¸­æª¢ç´¢ç›¸é—œçš„è²¡é‹äº‹æ¥­ç†è«–ï¼Œæä¾›å°ˆæ¥­è€Œå¯¦ç”¨çš„åˆ†æã€‚
"""
    
    def _get_future_analysis_prompt(self, chart_data: Dict[str, Any], basic_analysis: str) -> str:
        """æœªä¾†é‹å‹¢åˆ†ææç¤ºè©"""
        return f"""
è«‹åŸºæ–¼ä»¥ä¸‹å‘½ç›¤æ•¸æ“šå’ŒåŸºç¤åˆ†æï¼Œé€²è¡Œæ·±åº¦çš„æœªä¾†é‹å‹¢å°ˆæ¥­åˆ†æï¼š

å‘½ç›¤æ•¸æ“šï¼š
{chart_data}

åŸºç¤åˆ†æï¼š
{basic_analysis}

æœªä¾†é‹å‹¢å°ˆæ¥­åˆ†æè¦æ±‚ï¼š

## ğŸ”® å¤§é™é‹å‹¢åˆ†æ
- åˆ†æç•¶å‰å’Œæœªä¾†çš„å¤§é™ç‰¹è‰²
- é æ¸¬åå¹´é‹å‹¢çš„èµ·ä¼è®ŠåŒ–
- è­˜åˆ¥é‡è¦çš„äººç”Ÿè½‰æŠ˜é»

## â° æµå¹´é‹å‹¢é æ¸¬
- åˆ†æè¿‘æœŸæµå¹´çš„å‰å‡¶
- é æ¸¬é‡è¦äº‹ä»¶çš„ç™¼ç”Ÿæ™‚æ©Ÿ
- æä¾›å¹´åº¦é‹å‹¢æŒ‡å°

## ğŸŒŸ äººç”Ÿéšæ®µè¦åŠƒ
- åˆ†æä¸åŒäººç”Ÿéšæ®µçš„ç‰¹è‰²
- é æ¸¬å„éšæ®µçš„ç™¼å±•é‡é»
- æä¾›é•·æœŸè¦åŠƒå»ºè­°

## ğŸ¯ æœ€ä½³æ™‚æ©ŸæŠŠæ¡
- è­˜åˆ¥è¡Œå‹•çš„æœ€ä½³æ™‚æ©Ÿ
- é æ¸¬æ©Ÿæœƒå’ŒæŒ‘æˆ°çš„åˆ°ä¾†
- æä¾›æ™‚æ©Ÿé¸æ“‡çš„å»ºè­°

## ğŸš€ æœªä¾†ç™¼å±•ç­–ç•¥
- æä¾›é †æ‡‰é‹å‹¢çš„ç­–ç•¥
- æŒ‡å°å¦‚ä½•åŒ–è§£ä¸åˆ©å› ç´ 
- å»ºè­°å¯¦ç¾ç›®æ¨™çš„è·¯å¾‘

è«‹å¾çŸ¥è­˜åº«ä¸­æª¢ç´¢ç›¸é—œçš„é‹å‹¢é æ¸¬ç†è«–ï¼Œæä¾›å°ˆæ¥­è€Œå¯¦ç”¨çš„åˆ†æã€‚
"""
    
    def _get_comprehensive_analysis_prompt(self, chart_data: Dict[str, Any], basic_analysis: str) -> str:
        """ç¶œåˆåˆ†ææç¤ºè©"""
        return f"""
è«‹åŸºæ–¼ä»¥ä¸‹å‘½ç›¤æ•¸æ“šå’ŒåŸºç¤åˆ†æï¼Œé€²è¡Œå…¨é¢æ·±å…¥çš„ç¶œåˆå°ˆæ¥­åˆ†æï¼š

å‘½ç›¤æ•¸æ“šï¼š
{chart_data}

åŸºç¤åˆ†æï¼š
{basic_analysis}

ç¶œåˆå°ˆæ¥­åˆ†æè¦æ±‚ï¼š

## ğŸ¯ æ•´é«”å‘½æ ¼è©•ä¼°
- åˆ†æå‘½ç›¤çš„æ•´é«”æ ¼å±€
- è©•ä¼°äººç”Ÿçš„ç¸½é«”é‹å‹¢
- è­˜åˆ¥å‘½ç›¤çš„ç‰¹æ®Šæ ¼å±€

## ğŸŒŸ äººç”Ÿå„é ˜åŸŸå¹³è¡¡åˆ†æ
- æ„Ÿæƒ…ã€äº‹æ¥­ã€å¥åº·ã€è²¡é‹çš„å¹³è¡¡
- å„é ˜åŸŸçš„ç›¸äº’å½±éŸ¿
- æ•´é«”äººç”Ÿè¦åŠƒå»ºè­°

## ğŸ” æ·±å±¤æ€§æ ¼æ´å¯Ÿ
- åˆ†ææ€§æ ¼çš„å¤šé¢æ€§
- è­˜åˆ¥æ½›åœ¨çš„å¤©è³¦å’ŒæŒ‘æˆ°
- æä¾›è‡ªæˆ‘èªçŸ¥çš„æ·±åº¦è¦‹è§£

## âš–ï¸ å„ªå‹¢åŠ£å‹¢åˆ†æ
- å®¢è§€è©•ä¼°å€‹äººå„ªå‹¢
- è­˜åˆ¥éœ€è¦æ”¹å–„çš„æ–¹é¢
- æä¾›å¹³è¡¡ç™¼å±•çš„å»ºè­°

## ğŸš€ äººç”Ÿç™¼å±•ç­–ç•¥
- æä¾›å…¨é¢çš„äººç”ŸæŒ‡å°
- æ•´åˆå„é ˜åŸŸçš„ç™¼å±•å»ºè­°
- åˆ¶å®šå¯¦ç¾äººç”Ÿåƒ¹å€¼çš„ç­–ç•¥

è«‹å¾çŸ¥è­˜åº«ä¸­æª¢ç´¢ç›¸é—œçš„ç¶œåˆåˆ†æç†è«–ï¼Œæä¾›å°ˆæ¥­è€Œå…¨é¢çš„åˆ†æã€‚
"""

def create_domain_agent(domain_type: str = "comprehensive", logger=None) -> Agent:
    """å‰µå»º Domain Agent çš„ä¾¿æ·å‡½æ•¸"""
    domain_agent = DomainZiweiAgent(domain_type=domain_type, logger=logger)
    return domain_agent.get_agent()
